<!DOCTYPE html>
<html>
<head>
	<title>BDTproject</title>
	
	<!--Leaflet (map render)-->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>

	<!--jQuery-->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.js"></script>
</head>
<body>
	<div id="mapid"></div>

	<script type="text/javascript">
		var data = JSON.parse('{{ data|tojson }}')
		
		//HANDLE MAP VIEWPORT SIZE
		$('#mapid').height($(window).height() - 16)
		window.onresize = function () {
			$('#mapid').height($(window).height() - 16)    
		}

		//CREATING THE MAP
		var mymap = L.map('mapid').setView([46.010478, 11.127805], 13);
		L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
		    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		    maxZoom: 18,
		    id: 'mapbox/streets-v11',
		    tileSize: 512,
		    zoomOffset: -1,
		    accessToken: 'sk.eyJ1IjoiaXJvbjUxMiIsImEiOiJjazl0dHIwaWkwbjF5M2VwY3lqMXhvdDNxIn0.hnRColE3LzVhgDIHdPEdnA'
		}).addTo(mymap);

		var orange = L.icon({
		    iconUrl: '/images/Orange',
		    iconSize: [25, 41],
		    iconAnchor: [22, 94],
		    popupAnchor: [-3, -76],
		    shadowUrl: 'my-icon-shadow.png',
		    shadowSize: [68, 95],
		    shadowAnchor: [22, 94]
		});

		var red = L.icon({
		    iconUrl: '/images/Red',
		    iconSize: [25, 41],
		    iconAnchor: [22, 94],
		    popupAnchor: [-3, -76],
		    shadowUrl: 'my-icon-shadow.png',
		    shadowSize: [68, 95],
		    shadowAnchor: [22, 94]
		});

		var mmarker = []
		data.museums.forEach(function(item, index) {
			
			var tmp = L.marker([item.lat, item.lon], {icon : orange}).addTo(mymap);
			tmp.on('click',function() {
				tmp.bindPopup("<b>" + item.name + "</b><br>Sono un museo!")
			})
			
			mmarker.push(tmp)
		})

		var mark = L.marker([46.010478, 11.157805]).addTo(mymap);

		var dmarker = []
		data.docks.forEach(function(item, index) {
			
			var tmp = L.marker([item.lat, item.lon], {icon : red}).addTo(mymap);
			tmp.on('click',function() {
				tmp.bindPopup("<b>" + item.name + "</b><br>Sono un dock per le bici!")
			})
			
			dmarker.push(tmp)
		})

	</script>
</body>
</html>

